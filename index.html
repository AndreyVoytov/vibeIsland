<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Mini-Game</title>
  <style>
    :root{ --game-width:100vw; }
    html,body{ margin:0; height:100%; overflow:hidden; background:#000; }

    #gameWrapper{
      position:absolute;
      top:0; left:50%;
      transform:translateX(-50%);
      width:var(--game-width);
      height:100%;
      overflow:hidden;
    }

    .layer{
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      border:0;
    }
    #mapLayer        { z-index:0; display:none; }       /* невидимая инициализация карты */
    #layoutLayer     { z-index:1; }                     /* остров */
    #heroLayer       { z-index:2; background:transparent; } /* персонаж */
    #controllerLayer { z-index:3; background:transparent; } /* джойстик */
  </style>
</head>
<body>
  <div id="gameWrapper">
    <iframe id="mapLayer"        class="layer"></iframe>
    <iframe id="layoutLayer"     class="layer"></iframe>
    <iframe id="heroLayer"       class="layer"></iframe>
    <iframe id="controllerLayer" class="layer"></iframe>
  </div>

  <script>
    /* —— портретная область —— */
    function setGameWidth(){
      const vw = innerWidth, vh = innerHeight, pr = 9/16;
      const gameW = (vw>vh) ? Math.floor(vh*pr) : vw;
      document.documentElement.style.setProperty('--game-width',`${gameW}px`);
    }
    setGameWidth(); addEventListener('resize', setGameWidth);

    /* —— последовательная загрузка по зависимостям —— */
    const mapFrame = document.getElementById('mapLayer');
    mapFrame.src = 'map.html';
    mapFrame.onload = () => {
      document.getElementById('layoutLayer').src     = 'layout.html';
      document.getElementById('heroLayer').src       = 'hero.html';
      document.getElementById('controllerLayer').src = 'controller.html';
    };
  </script>
</body>
</html>
